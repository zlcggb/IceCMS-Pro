(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/post/detail"],{"23e0":function(t,e,o){"use strict";o.r(e);var i=o("4edd"),n=o("6e4d");for(var s in n)["default"].indexOf(s)<0&&function(t){o.d(e,t,(function(){return n[t]}))}(s);o("f9c0");var a=o("828b"),u=Object(a["a"])(n["default"],i["b"],i["c"],!1,null,"4a1c1378",null,!1,i["a"],void 0);e["default"]=u.exports},"333d":function(t,e,o){"use strict";(function(t,i){var n=o("47a9");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var s=n(o("7eb4")),a=n(o("ee10")),u={data:function(){return{unitId:this.$c.postDetailAd,postId:0,postDetail:{comment:[],media:[],comment_list:{data:[]},topic_info:{topic_name:""},userInfo:{avatar:""}},focus:!1,isSubmitD:!1,commentList:[],placeholder:"说点什么...",form:{pid:0,type:1,to_uid:"",post_id:"",content:""},showShare:!1,showCanvas:!1,page:1,loadStatus:"loadmore",isVoteExpire:!1}},computed:{timestamp:function(){return Date.parse(new Date)/1e3}},onShow:function(){},onLoad:function(e){this.postId=e.id,e.scene&&(this.postId=e.scene),this.form.post_id=this.postId,this.getPostDetail(),this.getCommentList(),t.showShareMenu({withShareTicket:!0,menus:["shareAppMessage","shareTimeline"]})},onReachBottom:function(){this.page++,this.getCommentList()},onShareAppMessage:function(t){var e;return"button"===t.from&&console.log(t.target),this.postDetail.media.length>0&&(e=this.postDetail.media[0]),{title:this.postDetail.content,path:"/pages/post/detail?id="+this.postId,imageUrl:e}},onShareTimeline:function(){var t=t=this.postDetail.media[0];return{title:this.postDetail.content,imageUrl:t,query:"id="+this.postId}},methods:{toMy:function(){i.switchTab({url:"/pages/my/my"})},appShares:function(){var t=t=this.postDetail.media[0],e=this,o=getCurrentPages();o[o.length-1].$page.fullPath;i.share({provider:"qq",type:0,href:"http://xy.tujingzg.com/api/post/detail?id="+e.postId,summary:e.postDetail.content,title:e.postDetail.content,imageUrl:t,success:function(t){i.showToast({title:"分享成功",icon:"none",duration:2e3}),e.posters=!1},fail:function(t){i.showToast({title:"分享失败",icon:"none",duration:2e3}),e.posters=!1}})},appShare:function(t){var e=e=this.postDetail.media[0],o=this,n=getCurrentPages();n[n.length-1].$page.fullPath;i.share({provider:"weixin",scene:t,type:0,href:"http://xy.tujingzg.com/api/post/detail?id="+o.postId,summary:o.postDetail.content,title:o.postDetail.content,imageUrl:e,success:function(t){i.showToast({title:"分享成功",icon:"none",duration:2e3}),o.posters=!1},fail:function(t){i.showToast({title:"分享失败",icon:"none",duration:2e3}),o.posters=!1}})},voteSubmit:function(){var t=this,e=[];this.postDetail.vote_info.options.forEach((function(t){t.checked&&e.push(t.id)})),this.$H.post("vote/userVote",{id:this.postDetail.vote_info.id,vote:e}).then((function(e){200==e.code&&t.getPostDetail()}))},castVote:function(t,e){var o=this;if(!this.postDetail.is_vote_result&&!this.isVoteExpire){1===e&&this.postDetail.vote_info.options.forEach((function(t){o.$set(t,"checked",!1)}));var i=this.postDetail.vote_info.options[t].checked;i?this.$set(this.postDetail.vote_info.options[t],"checked",!1):this.$set(this.postDetail.vote_info.options[t],"checked",!0)}},delComment:function(t,e,o){var n=this,s=i.getStorageSync("userInfo");t.uid==s.uid&&i.showModal({title:"提示",content:"确定删除该评论？",success:function(i){i.confirm?n.$H.post("comment/del",{id:t.id}).then((function(t){200==t.code&&(o||0===o?n.commentList[e].children.splice(o,1):n.commentList.splice(e,1))})):i.cancel}})},onCopy:function(){i.setClipboardData({data:this.postDetail.content,success:function(){i.showToast({title:"复制成功"})}})},saveImgToAlbum:function(){var t=this;i.canvasToTempFilePath({x:0,y:0,width:300,height:450,canvasId:"shareCanvas",success:function(e){i.saveImageToPhotosAlbum({filePath:e.tempFilePath,success:function(){t.showCanvas=!1}})}})},shareCanvas:function(){var t=this;return(0,a.default)(s.default.mark((function e(){var o,n,a,u,c;return s.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return i.showLoading({mask:!0,title:"正在生成海报"}),t.showCanvas=!0,t.showShare=!1,o=i.createCanvasContext("shareCanvas"),o.setFillStyle("#FFFFFF"),o.fillRect(0,0,300,450),n=t.postDetail.media[0]?t.postDetail.media[0]:"https://"+t.$c.baseUrl+"/uploads/default_shre_bg.jpg",e.next=9,t.downloadFile(n);case 9:return a=e.sent,o.drawImage(a,0,0,300,240),o.setFillStyle("#616161"),o.setFontSize(14),t.drawText(o,t.postDetail["content"],20,270,30,260,5),o.setFillStyle("#616161"),o.setFontSize(14),o.fillText("来源：云喵圈子",20,430,300),e.next=19,t.getQrCode();case 19:return u=e.sent,e.next=22,t.downloadFile(u);case 22:c=e.sent,o.drawImage(c,220,370,70,70),o.draw(),i.hideLoading();case 26:case"end":return e.stop()}}),e)})))()},drawText:function(t,e,o,i,n,s,a){for(var u=1,c=0,r=0,l=0;l<e.length;l++)c+=t.measureText(e[l]).width,c>s&&u<=a&&(t.fillText(e.substring(r,l),o,i),i+=22,c=0,r=l,n+=22,u++),l==e.length-1&&u<=a&&t.fillText(e.substring(r,l+1),o,i);return n+=10,n},downloadFile:function(t){return new Promise((function(e){i.downloadFile({url:t,success:function(t){e(t.tempFilePath)}})}))},getQrCode:function(){var t=this;return new Promise((function(e){t.$H.get("post/qrCode",{id:t.postId}).then((function(t){e(t.result)}))}))},onThumbs:function(t,e,o){var i=this;this.$H.post("comment/thumbs",{id:t}).then((function(t){200==t.code&&(o||0==o?(i.commentList[e].children[o].is_thumbs=!0,i.commentList[e].children[o].thumbs++):(i.commentList[e].is_thumbs=!0,i.commentList[e].thumbs++))}))},cancelThumbs:function(t,e,o){var i=this;this.$H.post("comment/cancelThumbs",{id:t}).then((function(t){200==t.code&&(o||0==o?(i.commentList[e].children[o].is_thumbs=!1,i.commentList[e].children[o].thumbs--):(i.commentList[e].is_thumbs=!1,i.commentList[e].thumbs--))}))},onReply:function(t){this.placeholder="回复："+t.userInfo.username,this.focus=!0;var e=t.pid;this.form.pid=0===e?t.id:t.pid,this.form.to_uid=t.userInfo.uid,this.form.post_id=this.postId},onBlur:function(){this.placeholder="说点什么...",this.focus=!1,this.form.pid=0},getCommentList:function(){var t=this;this.loadStatus="loading",this.$H.get("comment/list",{post_id:this.postId,page:this.page}).then((function(e){200==e.code&&(t.commentList=t.commentList.concat(e.result.data),e.result.current_page===e.result.last_page||0===e.result.last_page?t.loadStatus="nomore":t.loadStatus="loadmore")}))},jumpUser:function(t){i.navigateTo({url:"/pages/user/home?uid="+t})},addComment:function(){var t=this;if(this.isSubmitD=!0,""==this.form.content)return this.$u.toast("评论不能为空"),void(this.isSubmitD=!1);i.showLoading({mask:!0,title:"发布中"}),this.$H.post("post/addComment",this.form).then((function(e){200==e.code&&(t.form.content="",t.$u.toast("评论成功"),t.page=1,t.getPostDetail(),t.commentList=[],t.getCommentList()),t.isSubmitD=!1,i.hideLoading()}))},getPostDetail:function(){var t=this;this.$H.get("post/detail",{id:this.postId}).then((function(e){if(t.postDetail=e.result,e.result.vote_id>0){e.result.vote_info.options.forEach((function(e){t.$set(e,"checked",!1)}));var o=Date.parse(new Date)/1e3;e.result.vote_info.expire_time<o&&(t.isVoteExpire=!0)}}))},cancelCollection:function(){var t=this;this.$H.post("post/cancelCollection",{id:this.postId}).then((function(e){200===e.code&&(t.postDetail.is_collection=!1,t.postDetail.collection_count--)}))},addCollection:function(){var t=this;this.$H.post("post/addCollection",{id:this.postId,uid:this.postDetail.uid}).then((function(e){200===e.code&&(t.postDetail.is_collection=!0,t.postDetail.collection_count++)}))},addThumb:function(){var t=this;this.$H.post("post/addThumb",{id:this.postId}).then((function(e){200===e.code&&(t.postDetail.is_thumb=!0)}))},cancelThumb:function(){var t=this;this.$H.post("post/cancelThumb",{id:this.postId,uid:this.postDetail.uid}).then((function(e){200===e.code&&(t.postDetail.is_thumb=!1)}))},follow:function(){var t=this;this.$H.post("user/addFollow",{id:this.postDetail.uid}).then((function(e){200===e.code?t.postDetail.is_follow=!0:t.$refs.uToast.show({title:e.msg,type:"error"})}))},cancelFollow:function(){var t=this;this.$H.post("user/cancelFollow",{id:this.postDetail.uid}).then((function(e){200===e.code&&(t.postDetail.is_follow=!1)}))},previewImage:function(t){var e=this;this.$H.post("post/checkint",{post_id:this.postId}).then((function(o){200==o.code?(e.$u.toast(""),i.previewImage({current:t.currentTarget.dataset.current,urls:t.currentTarget.dataset.image})):(e.$u.toast(""),0==e.postDetail.integral?i.previewImage({current:t.currentTarget.dataset.current,urls:t.currentTarget.dataset.image}):(e.$u.toast(""),i.showModal({title:"下载将消耗一次下载次数,确认后长按保存图片即可",content:"原创作者拍摄不易，未经原创作者授权，禁止任何商业用途",success:function(o){o.confirm?e.$H.post("post/numdownimg",{post_id:e.postId}).then((function(o){console.log(o),200===o.code?i.previewImage({current:t.currentTarget.dataset.current,urls:t.currentTarget.dataset.image}):i.showModal({title:"你的下载次数不足",content:"此内容需打赏["+e.postDetail.integral+"]音叶",success:function(o){o.confirm?e.$H.post("post/jfdownimg",{post_id:e.postId}).then((function(o){200===o.code?i.previewImage({current:t.currentTarget.dataset.current,urls:t.currentTarget.dataset.image}):(e.$u.toast("音叶不足，请充值音叶或成为会员"),e.jumpVip())})):o.cancel&&console.log("用户点击取消")}})})):res.cancel&&console.log("用户点击取消")}})))}))},jumpVip:function(){i.navigateTo({url:"/pages/my/vip"})}}};e.default=u}).call(this,o("3223")["default"],o("df3c")["default"])},"4edd":function(t,e,o){"use strict";o.d(e,"b",(function(){return n})),o.d(e,"c",(function(){return s})),o.d(e,"a",(function(){return i}));var i={uButton:function(){return o.e("uni_modules/uview-ui/components/u-button/u-button").then(o.bind(null,"ca2c"))},uIcon:function(){return o.e("uni_modules/uview-ui/components/u-icon/u-icon").then(o.bind(null,"ff9e"))},uAvatar:function(){return o.e("uni_modules/uview-ui/components/u-avatar/u-avatar").then(o.bind(null,"365c"))},uLoadmore:function(){return o.e("uni_modules/uview-ui/components/u-loadmore/u-loadmore").then(o.bind(null,"3983"))},uEmpty:function(){return o.e("uni_modules/uview-ui/components/u-empty/u-empty").then(o.bind(null,"c271"))},uPopup:function(){return o.e("uni_modules/uview-ui/components/u-popup/u-popup").then(o.bind(null,"d940"))},qButton:function(){return o.e("components/q-button/q-button").then(o.bind(null,"0899"))}},n=function(){var t=this,e=t.$createElement,o=(t._self._c,t._f("timeFrom")(t.postDetail.create_time)),i=1==t.postDetail.type?t.postDetail.media.length:null,n=1==t.postDetail.type?t.postDetail.media.length:null,s=1==t.postDetail.type?t.postDetail.media.length:null,a=2==t.postDetail.type&&t.postDetail.media.length>0,u=4!==t.postDetail.type||t.isVoteExpire?null:t._f("date")(t.postDetail.vote_info.expire_time,"yyyy年mm月dd日hh时MM分"),c=t.postDetail.topic_id?t.postDetail.topic_info.topic_name.substring(0,15):null,r=t.commentList.length,l=t.__map(t.commentList,(function(e,o){var i=t.__get_orig(e),n=t._f("timeFrom")(e.create_time),s=e.children.length,a=t.__map(e.children,(function(e,o){var i=t.__get_orig(e),n=s>0?t._f("timeFrom")(e.create_time):null;return{$orig:i,f3:n}}));return{$orig:i,f2:n,g6:s,l0:a}})),d=t.commentList.length;t._isMounted||(t.e0=function(e){t.focus=!0},t.e1=function(e){t.showShare=!0},t.e2=function(e){t.showShare=!1}),t.$mp.data=Object.assign({},{$root:{f0:o,g0:i,g1:n,g2:s,g3:a,f1:u,g4:c,g5:r,l1:l,g7:d}})},s=[]},"6e4d":function(t,e,o){"use strict";o.r(e);var i=o("333d"),n=o.n(i);for(var s in i)["default"].indexOf(s)<0&&function(t){o.d(e,t,(function(){return i[t]}))}(s);e["default"]=n.a},"8a9b":function(t,e,o){"use strict";(function(t,e){var i=o("47a9");o("7882");i(o("3240"));var n=i(o("23e0"));t.__webpack_require_UNI_MP_PLUGIN__=o,e(n.default)}).call(this,o("3223")["default"],o("df3c")["createPage"])},"93da":function(t,e,o){},f9c0:function(t,e,o){"use strict";var i=o("93da"),n=o.n(i);n.a}},[["8a9b","common/runtime","common/vendor"]]]);