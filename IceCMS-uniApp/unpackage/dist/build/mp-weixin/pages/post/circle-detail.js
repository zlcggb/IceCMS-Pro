(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/post/circle-detail"],{"04f7":function(t,e,o){},1644:function(t,e,o){"use strict";(function(t,e){var n=o("47a9");o("7882");n(o("3240"));var i=n(o("b85a"));t.__webpack_require_UNI_MP_PLUGIN__=o,e(i.default)}).call(this,o("3223")["default"],o("df3c")["createPage"])},2649:function(t,e,o){},"302d":function(t,e,o){"use strict";var n=o("ebce"),i=o.n(n);i.a},"5f2f":function(t,e,o){"use strict";o.d(e,"b",(function(){return i})),o.d(e,"c",(function(){return s})),o.d(e,"a",(function(){return n}));var n={uNavbar:function(){return o.e("uni_modules/uview-ui/components/u-navbar/u-navbar").then(o.bind(null,"2010"))},uButton:function(){return o.e("uni_modules/uview-ui/components/u-button/u-button").then(o.bind(null,"ca2c"))},uIcon:function(){return o.e("uni_modules/uview-ui/components/u-icon/u-icon").then(o.bind(null,"ff9e"))},uLoadmore:function(){return o.e("uni_modules/uview-ui/components/u-loadmore/u-loadmore").then(o.bind(null,"3983"))},uEmpty:function(){return o.e("uni_modules/uview-ui/components/u-empty/u-empty").then(o.bind(null,"c271"))},uPopup:function(){return o.e("uni_modules/uview-ui/components/u-popup/u-popup").then(o.bind(null,"d940"))},qButton:function(){return o.e("components/q-button/q-button").then(o.bind(null,"0899"))}},i=function(){var t=this,e=t.$createElement,o=(t._self._c,t.getTime(t.postDetail.addTime)),n=1==t.postDetail.type?t.postDetail.media.length:null,i=1==t.postDetail.type?t.postDetail.media.length:null,s=1==t.postDetail.type?t.postDetail.media.length:null,a=2==t.postDetail.type&&t.postDetail.media.length>0,u=4!==t.postDetail.type||t.isVoteExpire?null:t._f("date")(t.postDetail.vote_info.expire_time,"yyyy年mm月dd日hh时MM分"),c=t.postDetail.topic_id?t.postDetail.topic_info.topic_name.substring(0,15):null,r=t.commentList.length,l=t.__map(t.commentList,(function(e,o){var n=t.__get_orig(e),i=e?t.getTime(e.addTime):null,s=e?e.reply.length:null,a=e&&s>0?t.__map(e.reply,(function(e,o){var n=t.__get_orig(e),i=t.getTime(e.addTime);return{$orig:n,m2:i}})):null;return{$orig:n,m1:i,g6:s,l0:a}})),d=t.commentList.length;t._isMounted||(t.e0=function(e){t.focus=!0},t.e1=function(e){t.showShare=!0},t.e2=function(e){t.showShare=!1}),t.$mp.data=Object.assign({},{$root:{m0:o,g0:n,g1:i,g2:s,g3:a,f0:u,g4:c,g5:r,l1:l,g7:d}})},s=[]},"89b1":function(t,e,o){"use strict";(function(t,n){var i=o("47a9");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var s=i(o("7eb4")),a=i(o("ee10")),u=o("0f04"),c=i(o("c8ae")),r={data:function(){return{unitId:this.$c.postDetailAd,postId:0,postDetail:{comment:[],media:[],comment_list:{data:[]},topic_info:{topic_name:""},userInfo:{avatar:""}},focus:!1,isSubmitD:!1,commentList:[],placeholder:"说点什么...",form:{parentId:0,type:1,userId:"",toUserId:"",postId:"",content:""},showShare:!1,showCanvas:!1,page:1,loadStatus:"loadmore",isVoteExpire:!1}},computed:{timestamp:function(){return Date.parse(new Date)/1e3}},onShow:function(){},onLoad:function(e){this.postId=e.id,e.scene&&(this.postId=e.scene),this.form.postId=this.postId,this.getPostDetail(),this.getCommentList(),t.showShareMenu({withShareTicket:!0,menus:["shareAppMessage","shareTimeline"]})},onReachBottom:function(){this.page++,this.getCommentList()},onShareAppMessage:function(t){var e;return"button"===t.from&&console.log(t.target),this.postDetail.media.length>0&&(e=this.postDetail.media[0]),{title:this.postDetail.content,path:"/pages/post/detail?id="+this.postId,imageUrl:e}},onShareTimeline:function(){var t=t=this.postDetail.media[0];return{title:this.postDetail.content,imageUrl:t,query:"id="+this.postId}},methods:{getTime:function(t){var e=new Date,o=e.getTime(),n=new Date(t).getTime(),i=o-n,s=Math.floor(i/864e5);Math.floor(i/6048e5),Math.floor(i/2592e6),Math.floor(i/31536e6);if(0==s)return 0==Math.floor(i/36e5)?0==Math.floor(i/6e4)?"刚刚":Math.floor(i/6e4)+"分钟前":Math.floor(i/36e5)+"小时前";if(1==s)return"昨天";if(2==s)return"前天";if(s>2&&s<7)return"最近一周";if(s>=7&&s<30)return"一个月内";if(s>=30&&s<60)return"一个月前";if(s>=60&&s<90)return"二个月前";if(s>=90&&s<120)return"三个月前";if(s>=120&&s<160)return"四个月前";if(s>=160&&s<180)return"五个月前";if(s>=180&&s<210)return"六个月前";if(s>=240&&s<270)return"七个月前";if(s>=300&&s<330)return"八个月前";if(s>=330&&s<365)return"九个月前";if(s>=365){var a=new Date(t);return(0,u.formatDate)(a,"yyyy-MM-dd")}},toMy:function(){n.switchTab({url:"/pages/my/my"})},appShares:function(){var t=t=this.postDetail.media[0],e=this,o=getCurrentPages();o[o.length-1].$page.fullPath;n.share({provider:"qq",type:0,href:"http://xy.tujingzg.com/api/post/detail?id="+e.postId,summary:e.postDetail.content,title:e.postDetail.content,imageUrl:t,success:function(t){n.showToast({title:"分享成功",icon:"none",duration:2e3}),e.posters=!1},fail:function(t){n.showToast({title:"分享失败",icon:"none",duration:2e3}),e.posters=!1}})},appShare:function(t){var e=e=this.postDetail.media[0],o=this,i=getCurrentPages();i[i.length-1].$page.fullPath;n.share({provider:"weixin",scene:t,type:0,href:"http://xy.tujingzg.com/api/post/detail?id="+o.postId,summary:o.postDetail.content,title:o.postDetail.content,imageUrl:e,success:function(t){n.showToast({title:"分享成功",icon:"none",duration:2e3}),o.posters=!1},fail:function(t){n.showToast({title:"分享失败",icon:"none",duration:2e3}),o.posters=!1}})},voteSubmit:function(){var t=this,e=[];this.postDetail.vote_info.options.forEach((function(t){t.checked&&e.push(t.id)})),this.$H.post("vote/userVote",{id:this.postDetail.vote_info.id,vote:e}).then((function(e){200==e.code&&t.getPostDetail()}))},castVote:function(t,e){var o=this;if(!this.postDetail.is_vote_result&&!this.isVoteExpire){1===e&&this.postDetail.vote_info.options.forEach((function(t){o.$set(t,"checked",!1)}));var n=this.postDetail.vote_info.options[t].checked;n?this.$set(this.postDetail.vote_info.options[t],"checked",!1):this.$set(this.postDetail.vote_info.options[t],"checked",!0)}},delComment:function(t,e,o){var i=this,s=n.getStorageSync("userInfo");t.uid==s.uid&&n.showModal({title:"提示",content:"确定删除该评论？",success:function(n){n.confirm?i.$H.post("comment/del",{id:t.id}).then((function(t){200==t.code&&(o||0===o?i.commentList[e].children.splice(o,1):i.commentList.splice(e,1))})):n.cancel}})},onCopy:function(){n.setClipboardData({data:this.postDetail.content,success:function(){n.showToast({title:"复制成功"})}})},saveImgToAlbum:function(){var t=this;n.canvasToTempFilePath({x:0,y:0,width:300,height:450,canvasId:"shareCanvas",success:function(e){n.saveImageToPhotosAlbum({filePath:e.tempFilePath,success:function(){t.showCanvas=!1}})}})},shareCanvas:function(){var t=this;return(0,a.default)(s.default.mark((function e(){var o,i,a,u,c;return s.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n.showLoading({mask:!0,title:"正在生成海报"}),t.showCanvas=!0,t.showShare=!1,o=n.createCanvasContext("shareCanvas"),o.setFillStyle("#FFFFFF"),o.fillRect(0,0,300,450),i=t.postDetail.media[0]?t.postDetail.media[0]:"https://"+t.$c.baseUrl+"/uploads/default_shre_bg.jpg",e.next=9,t.downloadFile(i);case 9:return a=e.sent,o.drawImage(a,0,0,300,240),o.setFillStyle("#616161"),o.setFontSize(14),t.drawText(o,t.postDetail["content"],20,270,30,260,5),o.setFillStyle("#616161"),o.setFontSize(14),o.fillText("来源：云喵圈子",20,430,300),e.next=19,t.getQrCode();case 19:return u=e.sent,e.next=22,t.downloadFile(u);case 22:c=e.sent,o.drawImage(c,220,370,70,70),o.draw(),n.hideLoading();case 26:case"end":return e.stop()}}),e)})))()},drawText:function(t,e,o,n,i,s,a){for(var u=1,c=0,r=0,l=0;l<e.length;l++)c+=t.measureText(e[l]).width,c>s&&u<=a&&(t.fillText(e.substring(r,l),o,n),n+=22,c=0,r=l,i+=22,u++),l==e.length-1&&u<=a&&t.fillText(e.substring(r,l+1),o,n);return i+=10,i},downloadFile:function(t){return new Promise((function(e){n.downloadFile({url:t,success:function(t){e(t.tempFilePath)}})}))},getQrCode:function(){var t=this;return new Promise((function(e){t.$H.get("post/qrCode",{id:t.postId}).then((function(t){e(t.result)}))}))},onThumbs:function(t,e,o){var n=this;this.$H.post("comment/thumbs",{id:t}).then((function(t){200==t.code&&(o||0==o?(n.commentList[e].children[o].is_thumbs=!0,n.commentList[e].children[o].thumbs++):(n.commentList[e].is_thumbs=!0,n.commentList[e].thumbs++))}))},cancelThumbs:function(t,e,o){var n=this;this.$H.post("comment/cancelThumbs",{id:t}).then((function(t){200==t.code&&(o||0==o?(n.commentList[e].children[o].is_thumbs=!1,n.commentList[e].children[o].thumbs--):(n.commentList[e].is_thumbs=!1,n.commentList[e].thumbs--))}))},onReply:function(t){console.log(t),this.placeholder="回复："+t.reviewers,this.focus=!0;var e=t.parentId;this.form.parentId=0===e?t.id:t.parentId,console.log(this.form.parentId),this.form.toUserId=t.userId,this.form.postId=this.postId},onBlur:function(){this.placeholder="说点什么...",this.focus=!1},getCommentList:function(){var t=this;this.loadStatus="loading",n.request({url:c.default.GetPlanetIdComment(this.postId),success:function(e){t.commentList=e.data,t.loadStatus="加载完成"}})},jumpUser:function(t){n.navigateTo({url:"/pages/user/home?uid="+t})},addComment:function(){var t=this;if(this.isSubmitD=!0,""==this.form.content)return this.$u.toast("评论不能为空"),void(this.isSubmitD=!1);n.showLoading({mask:!0,title:"发布中"}),this.form.userId=this.$store.state.userInfo.userid,console.log(this.form.parentId),n.request({url:c.default.AddPlanetComment(),data:this.form,method:"POST",success:function(e){200==e.statusCode&&(t.form.content="",t.$u.toast("评论成功"),t.getPostDetail(),null!=t.commentList&&(t.commentList=[]),t.getCommentList()),t.isSubmitD=!1,n.hideLoading()}})},getPostDetail:function(){var t=this;n.request({url:c.default.GetSquareById(this.postId),success:function(e){console.log(e),t.postDetail=e.data}})},cancelCollection:function(){this.postDetail.is_collection=!1,this.postDetail.loveNum--},addCollection:function(){var t=this;n.request({url:c.default.LikeClickComments(this.postDetail.id),success:function(e){console.log(e),200===e.statusCode&&(t.postDetail.is_collection=!0,t.postDetail.loveNum++)}})},likeClick:function(t){console.log(t.id),n.request({url:c.default.LikeClickComment(t.id),success:function(e){console.log(e),200===e.statusCode&&(t.is_collection=!0,t.loveNum++)}})},cancelClick:function(t){t.is_collection=!1,t.loveNum--},likeClicks:function(t){console.log(t.id),n.request({url:c.default.LikeClickComment(t.id),success:function(e){console.log(e),200===e.statusCode&&(t.is_collection=!0,t.loveNum++)}})},cancelClicks:function(t){t.is_collection=!1,t.loveNum--},addThumb:function(){var t=this;this.$H.post("post/addThumb",{id:this.postId}).then((function(e){200===e.code&&(t.postDetail.is_thumb=!0)}))},cancelThumb:function(){var t=this;this.$H.post("post/cancelThumb",{id:this.postId,uid:this.postDetail.uid}).then((function(e){200===e.code&&(t.postDetail.is_thumb=!1)}))},follow:function(){var t=this;this.$H.post("user/addFollow",{id:this.postDetail.uid}).then((function(e){200===e.code?t.postDetail.is_follow=!0:t.$refs.uToast.show({title:e.msg,type:"error"})}))},cancelFollow:function(){var t=this;this.$H.post("user/cancelFollow",{id:this.postDetail.uid}).then((function(e){200===e.code&&(t.postDetail.is_follow=!1)}))},previewImage:function(t){var e=this;this.$H.post("post/checkint",{postId:this.postId}).then((function(o){200==o.code?(e.$u.toast(""),n.previewImage({current:t.currentTarget.dataset.current,urls:t.currentTarget.dataset.image})):(e.$u.toast(""),0==e.postDetail.integral?n.previewImage({current:t.currentTarget.dataset.current,urls:t.currentTarget.dataset.image}):(e.$u.toast(""),n.showModal({title:"下载将消耗一次下载次数,确认后长按保存图片即可",content:"原创作者拍摄不易，未经原创作者授权，禁止任何商业用途",success:function(o){o.confirm?e.$H.post("post/numdownimg",{postId:e.postId}).then((function(o){console.log(o),200===o.code?n.previewImage({current:t.currentTarget.dataset.current,urls:t.currentTarget.dataset.image}):n.showModal({title:"你的下载次数不足",content:"此内容需打赏["+e.postDetail.integral+"]音叶",success:function(o){o.confirm?e.$H.post("post/jfdownimg",{postId:e.postId}).then((function(o){200===o.code?n.previewImage({current:t.currentTarget.dataset.current,urls:t.currentTarget.dataset.image}):(e.$u.toast("音叶不足，请充值音叶或成为会员"),e.jumpVip())})):o.cancel&&console.log("用户点击取消")}})})):res.cancel&&console.log("用户点击取消")}})))}))},jumpVip:function(){n.navigateTo({url:"/pages/my/vip"})}}};e.default=r}).call(this,o("3223")["default"],o("df3c")["default"])},"8a20":function(t,e,o){"use strict";var n=o("af77"),i=o.n(n);i.a},af77:function(t,e,o){},b85a:function(t,e,o){"use strict";o.r(e);var n=o("5f2f"),i=o("fe7c");for(var s in i)["default"].indexOf(s)<0&&function(t){o.d(e,t,(function(){return i[t]}))}(s);o("8a20"),o("fc99"),o("302d"),o("ec13");var a=o("828b"),u=Object(a["a"])(i["default"],n["b"],n["c"],!1,null,"45d678ef",null,!1,n["a"],void 0);e["default"]=u.exports},ebce:function(t,e,o){},ec13:function(t,e,o){"use strict";var n=o("2649"),i=o.n(n);i.a},fc99:function(t,e,o){"use strict";var n=o("04f7"),i=o.n(n);i.a},fe7c:function(t,e,o){"use strict";o.r(e);var n=o("89b1"),i=o.n(n);for(var s in n)["default"].indexOf(s)<0&&function(t){o.d(e,t,(function(){return n[t]}))}(s);e["default"]=i.a}},[["1644","common/runtime","common/vendor"]]]);